%% System Parameters
%% A123:AMP20M1HD
%% Main %%
% Vector of state-of-charge values, SOC, (Datasheet Derived) | (101x1)
SOC_vecDatasheet = [0;0.01;0.02;0.03;0.04;0.05;0.06;0.07;0.08;0.09;0.1;0.11;0.12;0.13;0.14;0.15;0.16;0.17;0.18;0.19;0.2;0.21;0.22;0.23;0.24;0.25;0.26;0.27;0.28;0.29;0.3;0.31;0.32;0.33;0.34;0.35;0.36;0.37;0.38;0.39;0.4;0.41;0.42;0.43;0.44;0.45;0.46;0.47;0.48;0.49;0.5;0.51;0.52;0.53;0.54;0.55;0.56;0.57;0.58;0.59;0.6;0.61;0.62;0.63;0.64;0.65;0.66;0.67;0.68;0.69;0.7;0.71;0.72;0.73;0.74;0.75;0.76;0.77;0.78;0.79;0.8;0.81;0.82;0.83;0.84;0.85;0.86;0.87;0.88;0.89;0.9;0.91;0.92;0.93;0.94;0.95;0.96;0.97;0.98;0.99;1];

% Vector of state-of-charge values, SOC, (Simplified) | (1x7)
SOC_vec = [0, 0.1667, 0.3333, 0.5000, 0.6667, 0.8333, 1];

% Vector of temperatures, T, (C°), (Datasheet Derived) | (5x1)
T_vecDatasheet = [-10; 0; 10; 25; 35];

% Vector of temperatures, T, (K), (Simplified) | (1x3)
T_vec = [263.15, 283.15, 308.15]; % [-10, 10, 35] (°C)

% Open-circuit voltage, V0(SOC,T), (V), (Datasheet Derived) | (501x1)
V0_matDatasheet = [2.93217;2.94263;2.95309;2.96355;2.97401;2.98447;2.99493;3.02455;3.05382;3.07377;3.08453;3.09529;3.09916;3.10271;3.10625;3.1098;3.11335;3.11689;3.12044;3.13089;3.13795;3.14459;3.14961;3.15451;3.15932;3.16324;3.16716;3.17063;3.17297;3.17544;3.17798;3.18052;3.18295;3.18533;3.18771;3.19009;3.19215;3.19403;3.1959;3.19777;3.1998;3.20198;3.20371;3.20501;3.20619;3.20738;3.20856;3.20974;3.21092;3.2121;3.21329;3.21447;3.21565;3.21672;3.21787;3.21904;3.22021;3.22139;3.22256;3.22374;3.22492;3.2261;3.22728;3.22847;3.22965;3.23083;3.23201;3.23319;3.23437;3.23552;3.23652;3.23778;3.23909;3.24045;3.24217;3.2439;3.24563;3.24736;3.24909;3.25082;3.25255;3.25428;3.256;3.25774;3.25951;3.26116;3.26238;3.26307;3.26352;3.26396;3.26441;3.26485;3.2653;3.26593;3.26612;3.26743;3.26879;3.27596;3.2842;3.30299;3.33677;2.93217;2.94263;2.95309;2.96355;2.97401;2.98447;2.99493;3.02455;3.05382;3.07377;3.08453;3.09529;3.09916;3.10271;3.10625;3.1098;3.11335;3.11689;3.12044;3.13089;3.13795;3.14459;3.14961;3.15451;3.15932;3.16324;3.16716;3.17063;3.17297;3.17544;3.17798;3.18052;3.18295;3.18533;3.18771;3.19009;3.19215;3.19403;3.1959;3.19777;3.1998;3.20198;3.20371;3.20501;3.20619;3.20738;3.20856;3.20974;3.21092;3.2121;3.21329;3.21447;3.21565;3.21672;3.21787;3.21904;3.22021;3.22139;3.22256;3.22374;3.22492;3.2261;3.22728;3.22847;3.22965;3.23083;3.23201;3.23319;3.23437;3.23552;3.23652;3.23778;3.23909;3.24045;3.24217;3.2439;3.24563;3.24736;3.24909;3.25082;3.25255;3.25428;3.256;3.25774;3.25951;3.26116;3.26238;3.26307;3.26352;3.26396;3.26441;3.26485;3.2653;3.26593;3.26612;3.26743;3.26879;3.27596;3.2842;3.30299;3.33677;2.93217;2.94263;2.95309;2.96355;2.97401;2.98447;2.99493;3.02455;3.05382;3.07377;3.08453;3.09529;3.09916;3.10271;3.10625;3.1098;3.11335;3.11689;3.12044;3.13089;3.13795;3.14459;3.14961;3.15451;3.15932;3.16324;3.16716;3.17063;3.17297;3.17544;3.17798;3.18052;3.18295;3.18533;3.18771;3.19009;3.19215;3.19403;3.1959;3.19777;3.1998;3.20198;3.20371;3.20501;3.20619;3.20738;3.20856;3.20974;3.21092;3.2121;3.21329;3.21447;3.21565;3.21672;3.21787;3.21904;3.22021;3.22139;3.22256;3.22374;3.22492;3.2261;3.22728;3.22847;3.22965;3.23083;3.23201;3.23319;3.23437;3.23552;3.23652;3.23778;3.23909;3.24045;3.24217;3.2439;3.24563;3.24736;3.24909;3.25082;3.25255;3.25428;3.256;3.25774;3.25951;3.26116;3.26238;3.26307;3.26352;3.26396;3.26441;3.26485;3.2653;3.26593;3.26612;3.26743;3.26879;3.27596;3.2842;3.30299;3.33677;2.93217;2.94263;2.95309;2.96355;2.97401;2.98447;2.99493;3.02455;3.05382;3.07377;3.08453;3.09529;3.09916;3.10271;3.10625;3.1098;3.11335;3.11689;3.12044;3.13089;3.13795;3.14459;3.14961;3.15451;3.15932;3.16324;3.16716;3.17063;3.17297;3.17544;3.17798;3.18052;3.18295;3.18533;3.18771;3.19009;3.19215;3.19403;3.1959;3.19777;3.1998;3.20198;3.20371;3.20501;3.20619;3.20738;3.20856;3.20974;3.21092;3.2121;3.21329;3.21447;3.21565;3.21672;3.21787;3.21904;3.22021;3.22139;3.22256;3.22374;3.22492;3.2261;3.22728;3.22847;3.22965;3.23083;3.23201;3.23319;3.23437;3.23552;3.23652;3.23778;3.23909;3.24045;3.24217;3.2439;3.24563;3.24736;3.24909;3.25082;3.25255;3.25428;3.256;3.25774;3.25951;3.26116;3.26238;3.26307;3.26352;3.26396;3.26441;3.26485;3.2653;3.26593;3.26612;3.26743;3.26879;3.27596;3.2842;3.30299;3.33677;2.93217;2.94263;2.95309;2.96355;2.97401;2.98447;2.99493;3.02455;3.05382;3.07377;3.08453;3.09529;3.09916;3.10271;3.10625;3.1098;3.11335;3.11689;3.12044;3.13089;3.13795;3.14459;3.14961;3.15451;3.15932;3.16324;3.16716;3.17063;3.17297;3.17544;3.17798;3.18052;3.18295;3.18533;3.18771;3.19009;3.19215;3.19403;3.1959;3.19777;3.1998;3.20198;3.20371;3.20501;3.20619;3.20738;3.20856;3.20974;3.21092;3.2121;3.21329;3.21447;3.21565;3.21672;3.21787;3.21904;3.22021;3.22139;3.22256;3.22374;3.22492;3.2261;3.22728;3.22847;3.22965;3.23083;3.23201;3.23319;3.23437;3.23552;3.23652;3.23778;3.23909;3.24045;3.24217;3.2439;3.24563;3.24736;3.24909;3.25082;3.25255;3.25428;3.256;3.25774;3.25951;3.26116;3.26238;3.26307;3.26352;3.26396;3.26441;3.26485;3.2653;3.26593;3.26612;3.26743;3.26879;3.27596;3.2842;3.30299;3.33677];

% Open-circuit voltage, V0(SOC,T), (V), (Simplified) | (7x3)
V0_mat  = [2.9322, 3.1640, 3.2138;
    3.2449, 3.0131, 3.1632;
    3.2135, 3.2446, 3.0940;
    3.1625, 3.2133, 3.2442;
    3.1749, 3.1617, 3.2131;
    3.2439, 3.2559, 3.1609;
    3.2128, 3.2436, 3.3368];

% Terminal voltage operating range [Min Max] (Datasheet Derived) | (1x2)
V_range = [1.8, 4];

% Terminal resistance, R0(SOC,T), (Ohm), (Datasheet Derived) | (501x1)
R0_matDatasheet = [0.07996;0.07879;0.07763;0.07646;0.07529;0.07413;0.07296;0.07278;0.07258;0.0719;0.07075;0.0696;0.06809;0.06657;0.06505;0.06353;0.06201;0.06049;0.05897;0.0578;0.05646;0.0551;0.05366;0.0522;0.05075;0.04925;0.04759;0.04591;0.04416;0.04243;0.0407;0.03899;0.03731;0.03563;0.03395;0.03227;0.03067;0.02945;0.02823;0.02701;0.02586;0.02512;0.02436;0.02358;0.02279;0.022;0.02121;0.02046;0.0201;0.01974;0.01938;0.01902;0.01865;0.01829;0.01792;0.01756;0.01735;0.01723;0.01712;0.017;0.01688;0.01676;0.01665;0.01653;0.01641;0.01629;0.01618;0.01606;0.01594;0.01589;0.01586;0.01584;0.01583;0.01581;0.01582;0.01583;0.01583;0.01584;0.01584;0.01585;0.01585;0.01586;0.01587;0.01587;0.01588;0.01589;0.01587;0.01582;0.01576;0.0157;0.01564;0.01558;0.01552;0.01539;0.01518;0.01502;0.01487;0.01501;0.01436;0.01329;0.01299;0.07435;0.07234;0.07033;0.06833;0.06632;0.06432;0.06231;0.06129;0.06024;0.05873;0.05673;0.05474;0.0524;0.05004;0.04768;0.04532;0.04298;0.04073;0.03848;0.03658;0.03451;0.03261;0.03068;0.02875;0.02681;0.02502;0.02356;0.02208;0.02054;0.01901;0.01812;0.01727;0.01641;0.01555;0.01474;0.01421;0.01366;0.0131;0.01254;0.01213;0.01192;0.01173;0.01151;0.01127;0.01107;0.01096;0.01085;0.01074;0.01063;0.01052;0.01042;0.01031;0.0102;0.01009;0.00998;0.00987;0.00976;0.00967;0.00965;0.00963;0.00961;0.00959;0.00957;0.00955;0.00953;0.00951;0.00949;0.00947;0.00945;0.00942;0.00937;0.00934;0.0093;0.00927;0.00926;0.00925;0.00924;0.00923;0.00921;0.00923;0.00925;0.00926;0.00928;0.0093;0.00932;0.00933;0.00933;0.00929;0.00924;0.00919;0.00915;0.0091;0.00905;0.00891;0.00871;0.00857;0.00844;0.0086;0.00795;0.00785;0.00622;0.07218;0.06844;0.0647;0.06096;0.05722;0.05347;0.04973;0.04698;0.0446;0.04247;0.03988;0.03743;0.03472;0.032;0.02927;0.02655;0.02426;0.02215;0.02004;0.01828;0.01635;0.01479;0.01317;0.01154;0.01054;0.01001;0.00948;0.00893;0.00832;0.00772;0.00742;0.0072;0.00697;0.00675;0.00652;0.0063;0.00605;0.00583;0.0058;0.00577;0.00574;0.00573;0.00569;0.00563;0.00557;0.0055;0.00544;0.00537;0.00534;0.00531;0.00528;0.00526;0.00523;0.00519;0.00516;0.00513;0.0051;0.00507;0.00504;0.00501;0.00498;0.00496;0.00493;0.0049;0.00488;0.00485;0.00482;0.00479;0.00477;0.00474;0.0047;0.00468;0.00466;0.00464;0.00464;0.00464;0.00465;0.00465;0.00465;0.00465;0.00465;0.00465;0.00465;0.00464;0.00463;0.00462;0.00459;0.00453;0.00446;0.00438;0.00431;0.00424;0.00416;0.0041;0.00401;0.00398;0.00396;0.00385;0.00371;0.00411;0.00111;0.00349;0.0033;0.00311;0.00292;0.00272;0.00253;0.00235;0.00233;0.00235;0.00232;0.00223;0.00214;0.00205;0.00196;0.00187;0.00181;0.00175;0.00169;0.00164;0.00167;0.00168;0.00168;0.00168;0.00168;0.00167;0.00167;0.00167;0.00167;0.00166;0.00165;0.00164;0.00164;0.00163;0.00163;0.00162;0.00162;0.00161;0.0016;0.00159;0.00159;0.00158;0.00158;0.00158;0.00157;0.00156;0.00156;0.00155;0.00154;0.00154;0.00153;0.00153;0.00152;0.00151;0.00151;0.0015;0.0015;0.0015;0.00149;0.00149;0.00149;0.00148;0.00148;0.00148;0.00147;0.00147;0.00147;0.00147;0.00146;0.00146;0.00146;0.00145;0.00146;0.00146;0.00147;0.00147;0.00148;0.00149;0.0015;0.0015;0.00151;0.00152;0.00153;0.00153;0.00154;0.00155;0.00155;0.00156;0.00155;0.00154;0.00153;0.00152;0.00151;0.0015;0.00148;0.00144;0.0014;0.00137;0.00136;0.00131;0.00127;0.00104;0.04758;0.01888;0.01407;0.00948;0.0049;0.00119;0.00022;0.00024;0.00024;0.00024;0.00024;0.00024;0.00024;0.00024;0.00024;0.00024;0.00024;0.00024;0.00024;0.0006;0.00078;0.00094;0.00101;0.00108;0.00114;0.00116;0.00118;0.00118;0.00112;0.00111;0.00113;0.00115;0.00116;0.00117;0.00119;0.0012;0.00119;0.00118;0.00117;0.00115;0.00115;0.00115;0.00113;0.00109;0.00111;0.00112;0.00114;0.00115;0.00117;0.00118;0.00119;0.00121;0.00122;0.00123;0.00124;0.00126;0.00127;0.00128;0.0013;0.00131;0.00133;0.00134;0.00135;0.00137;0.00138;0.0014;0.00141;0.00142;0.00143;0.00141;0.00139;0.00139;0.00138;0.00138;0.0014;0.00141;0.00143;0.00145;0.00146;0.00148;0.0015;0.00152;0.00153;0.00155;0.00157;0.00158;0.00157;0.00154;0.00146;0.00132;0.00118;0.00103;0.00089;0.00076;0.00061;0.00051;0.00041;0.00062;0.00087;0.00126;0.00185];

% Terminal resistance, R0(SOC,T), (Ohm), (Simplified) | (7x3)
%R0_mat  = [0.0800, 0.0489, 0.0192;
    %0.0158, 0.0621, 0.0250;
    %0.0104, 0.0092, 0.0458;
    %0.0101, 0.0053, 0.0046;
    %0.0021, 0.0017, 0.0015;
    %0.0015, 0.0103, 0.0011;
    %0.0012, 0.0014, 0.0019];

% Terminal resistance, R0(SOC,T), (Ohm), (Matlab Example) | (7x3)
R0_mat  = [.0117, .0085, .009; .011, .0085, .009; .0114, .0087, .0092; .0107, .0082, .0088; .0107, .0083, .0091; .0113, .0085, .0089; .0116, .0085, .0089];

% Terminal resistance, R0(SOC), (Ohm), (Datasheet Derived) | (501x1)
R0_mat2Datasheet = [0.00349;0.0033;0.00311;0.00292;0.00272;0.00253;0.00235;0.00233;0.00235;0.00232;0.00223;0.00214;0.00205;0.00196;0.00187;0.00181;0.00175;0.00169;0.00164;0.00167;0.00168;0.00168;0.00168;0.00168;0.00167;0.00167;0.00167;0.00167;0.00166;0.00165;0.00164;0.00164;0.00163;0.00163;0.00162;0.00162;0.00161;0.0016;0.00159;0.00159;0.00158;0.00158;0.00158;0.00157;0.00156;0.00156;0.00155;0.00154;0.00154;0.00153;0.00153;0.00152;0.00151;0.00151;0.0015;0.0015;0.0015;0.00149;0.00149;0.00149;0.00148;0.00148;0.00148;0.00147;0.00147;0.00147;0.00147;0.00146;0.00146;0.00146;0.00145;0.00146;0.00146;0.00147;0.00147;0.00148;0.00149;0.0015;0.0015;0.00151;0.00152;0.00153;0.00153;0.00154;0.00155;0.00155;0.00156;0.00155;0.00154;0.00153;0.00152;0.00151;0.0015;0.00148;0.00144;0.0014;0.00137;0.00136;0.00131;0.00127;0.00104];

% Terminal resistance, R0(SOC), (Ohm), (Simplified) | (7x3)
R0_mat2  = [0.0035    0.0025    0.0022
    0.0018    0.0017    0.0017
    0.0016    0.0016    0.0016
    0.0016    0.0015    0.0015
    0.0015    0.0015    0.0014
    0.0015    0.0015    0.0015
    0.0015    0.0014    0.0010];

% Cell capacity, AH, (A*hr), (Datasheet Derived) 
AH_min = 19.487; % Minimun
AH = 19.5; % Nominal Ah rating
AH_max = 20; % Maximum

%% Dynamics %%
% First polarization resistance, R1(SOC,T), (Ohm), (Matlab) | (21x1)
R1_matMatlab = [0.0109;0.0069;0.0047;0.0034;0.0033;0.0033;0.0028;0.0029;0.0024;0.0026;0.0016;0.0023;0.0018;0.0017;0.0013;0.0012;0.0013;0.001;0.0014;0.0011;0.0011];

% First polarization resistance, R1(SOC,T), (Ohm), (Simplified) | (7x3)
R1_mat  = [0.0109, 0.0069, 0.0047;
    0.0034, 0.0033, 0.0033;
    0.0028, 0.0029, 0.0024;
    0.0026, 0.0016, 0.0023;
    0.0018, 0.0017, 0.0013;
    0.0012, 0.0013, 0.0010;
    0.0014, 0.0011, 0.0011];

% First time constant, tau(SOC,T), (s), (Matlab) | (21x1)
tau1_matMatlab = [20;31;109;36;59;40;25;36;45;105;29;77;33;39;39;39;61;26;67;29;33];

% First time constant, tau(SOC,T), (s), (Simplified) | (7x3)
tau1_mat = [20, 31, 109;
    36, 59, 40;
    25, 36, 45;
   105, 29, 77;
    33, 39, 39;
    39, 61, 26;
    67, 29, 33];

%% Fade %%
% Vector of discharge cycle values, (N), (Datasheet Derived) | (100x1)
N0vecDatasheet = [0;66;131;196;261;326;391;456;521;586;651;716;781;846;911;976;1041;1106;1171;1236;1301;1366;1431;1496;1561;1626;1691;1756;1821;1886;1951;2016;2081;2146;2211;2276;2341;2406;2471;2536;2601;2666;2731;2796;2861;2926;2991;3056;3121;3186;3251;3316;3381;3446;3511;3576;3641;3706;3771;3836;3901;3966;4031;4096;4161;4226;4291;4356;4421;4486;4551;4616;4681;4746;4811;4876;4941;5006;5071;5136;5201;5266;5331;5396;5461;5526;5591;5656;5721;5786;5851;5916;5981;6046;6111;6176;6241;6306;6371;6436];

% Vector of discharge cycle values, (N), (Simplified) | (1x6)
N0vec = [0, 1288/100, 2575/100, 3862/100, 5149/100, 6436/100]; % Divided by 100 for simulation purposes

% Vector of temperatures for fade data, Tfade (K), (Datasheet Derived) | (1x4)
Tfadevec = [298.15, 308.15, 318.15, 328.15]; % [25, 35, 45, 55] (°C)

% Percentage change in open-circuit voltage, dV0(N), (Datasheet Derived) | (100x1)
dV0matDatasheet = [0;-0.3227;-0.6453;-0.9509;-1.1187;-1.2594;-1.4;-1.5407;-1.6219;-1.683;-1.7439;-1.8049;-1.8602;-1.9134;-1.9665;-2.0196;-2.0441;-2.0544;-2.0647;-2.075;-2.085;-2.0949;-2.1048;-2.1146;-2.1183;-2.1198;-2.1212;-2.1226;-2.1259;-2.1303;-2.1347;-2.1391;-2.1431;-2.1462;-2.1493;-2.1524;-2.1556;-2.1591;-2.1625;-2.166;-2.1695;-2.1729;-2.1764;-2.1798;-2.1833;-2.1867;-2.1902;-2.1936;-2.197;-2.2002;-2.2034;-2.2067;-2.2106;-2.2156;-2.2206;-2.2256;-2.2316;-2.2405;-2.2493;-2.2582;-2.2676;-2.2798;-2.292;-2.3042;-2.3164;-2.3294;-2.3424;-2.3556;-2.3688;-2.3818;-2.3947;-2.4077;-2.4207;-2.4336;-2.4465;-2.4594;-2.4722;-2.485;-2.4978;-2.5106;-2.5233;-2.5361;-2.5489;-2.5617;-2.5745;-2.5872;-2.5999;-2.6126;-2.6253;-2.6381;-2.6508;-2.6635;-2.6765;-2.6898;-2.703;-2.7163;-2.7295;-2.7428;-2.756;-2.7693];

% Percentage change in open-circuit voltage, dV0(N), (Simplified) | (6x4)
dV0mat = [0, -1.1615, -1.6591, -1.9088;
   -2.0566, -2.1001, -2.1210, -2.1353;
   -2.1506, -2.1651, -2.1800, -2.1948;
   -2.2092, -2.2313, -2.2708, -2.3237;
   -2.3801, -2.4358, -2.4911, -2.5461;
   -2.6010, -2.6558, -2.7123, -2.7693];

% Percentage change in terminal resistance, dR0(N), (Parameter Assumed) | (100x1) 
dR0matDatasheet = [0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0];

% Percentage change in terminal resistance, dR0(N), (Simplified) | (6x4)
dR0mat = [0, 0, 0, 0;
     0, 0, 0, 0;
     0, 0, 0, 0;
     0, 0, 0, 0;
     0, 0, 0, 0;
     0, 0, 0, 0];

% Percentage change in cell capacity, dAH(N), (Datasheet) | (100x1)
dAHmatDatasheet = [0;-0.319;-0.638;-0.939;-1.189;-1.439;-1.688;-1.938;-2.188;-2.435;-2.682;-2.93;-3.177;-3.424;-3.671;-3.918;-4.169;-4.421;-4.673;-4.925;-5.177;-5.429;-5.681;-5.933;-6.185;-6.437;-6.683;-6.917;-7.152;-7.386;-7.621;-7.855;-8.09;-8.324;-8.558;-8.793;-9.033;-9.292;-9.551;-9.809;-10.068;-10.327;-10.586;-10.845;-11.104;-11.363;-11.622;-11.88;-12.132;-12.374;-12.616;-12.857;-13.099;-13.341;-13.582;-13.824;-14.066;-14.307;-14.549;-14.791;-15.035;-15.281;-15.526;-15.772;-16.017;-16.263;-16.508;-16.757;-17.007;-17.256;-17.506;-17.755;-18.005;-18.254;-18.504;-18.752;-18.999;-19.246;-19.493;-19.74;-19.986;-20.233;-20.48;-20.727;-20.973;-21.219;-21.464;-21.71;-21.955;-22.201;-22.446;-22.692;-22.943;-23.199;-23.455;-23.711;-23.966;-24.222;-24.478;-24.733];

% Percentage change in cell capacity, dAH(N), (Simplified) | (6x4)
dAHmat = [ 0, -1.2651, -2.3383, -3.4025;
   -4.4758, -5.5605, -6.6402, -7.6515;
   -8.6602, -9.7417, -10.8563, -11.9677;
  -13.0148, -14.0555, -15.0992, -16.1560;
  -17.2235, -18.2975, -19.3641, -20.4263;
  -21.4854, -22.5423, -23.6331, -24.7330];

% Percentage change in first polarization resistance, dR1(N, Tfade)
dR1mat = [0, 0, 0, 0;
     0, 0, 0, 0;
     0, 0, 0, 0;
     0, 0, 0, 0;
     0, 0, 0, 0;
     0, 0, 0, 0];

%% Calendar Aging %%
% Simplified vector of time intervals, (Days), (Datasheet Simplified) | (1x3)
storage_dt_age_vec = [0, 500, 1000]; % [0, 43200000, 86400000] Seconds

% Vector of storage temperatures, (K), (Datasheet) | (1x3)
storage_T_age_vec = [296.15, 308.15, 318.15]; % [23, 35, 45] °C 

% Vector of sampled temperatures for capacity calendar aging, T_ac, (K), (Datasheet) | (1x3)
T_age_vec_capacity = storage_T_age_vec;  % Same as storage temperatures

% Vector of sampled storage time intervals for capacity calendar aging, t_ac, (s), (Datasheet Simplified) | (1x3)
dt_age_vec_capacity = storage_dt_age_vec;

% Percentage change in capacity due to calendar aging, dAH(t_ac,T_ac), (Datasheet Simplified) | (3x3)
dAH_age_mat = [
    0, -2, -5;     % 23°C
    0, -3.5, -9;   % 35°C
    0, -6, -12     % 45°C
];

%% Thermal %%
% Thermal mass (J/K)
thermal_mass = 446.4;

%% Initial Targets %%
% Current (positive in), (A)
i = 6;

% Terminal voltage, (V)
v = 2.9322;

% State of charge
% Battery initial SOC
initialSOC = 0.1;

% Battery 1 initial SOC
initialSOC1 = 0.1;

% Battery 2 initial SOC
initialSOC2 = 0.15;

% Discharge cycles
num_cycles = 0;

% Temperature, (K)
cell_temperature = 298.15; % 25 °C

%% Nominal Values %%
% Terminal voltage, (V)
v_nominal_value = 3.3;

% State of charge
% Battery final SOC
finalSOC = 1;

% Discharge cycles
num_cycles_nominal_value = 6436/100; % Divided by 100 for simulation purposes

%% Battery Estimation Data %%
% Cell area (m^2)
cell_area = 0.03632; % Length*Width = 0.160*0.227

% Heat transfer coefficient (W/(K*m^2))
h_conv = 5;

% Maximum cell voltage, (Nominal Voltage), (V)
vMax = 4; 

% Sample time (s)
Ts = 1;                            

%% Kalman Filter
% SOC Estimator (Adaptive Kalman Filter)
Q    = [1e-4 0 0;0 1e-4 0;0 0 1e-4]; % Covariance of the process noise, Q
R    = 0.05;                         % Covariance of the measurement noise, R
P0   = [1e-5 0 0; 0 1 0; 0 0 1e-5];  % Initial state error covariance, P0
SOC0 = initialSOC;                   % Estimator initial SOC 
R00  = 0.008;                        % Estimator initial R0 

%% Charging/Discharging Parameters %%
Kp   = 100; % Proportional gain CV controller
Ki   = 10;  % Integral gain CV controller
Kaw  = 1;   % Antiwindup gain CV controller

%% Balancing Parameters %%
BalThreshold = 0.005;   % Threshold for cell balancing (V)
